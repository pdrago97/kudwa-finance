<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kudwa Financial AI - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', path='/css/modern-dashboard.css') }}" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <span>Kudwa AI</span>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#chat" class="nav-link" data-section="chat">
                            <i class="fas fa-comments"></i>
                            <span>AI Chat</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#ontology" class="nav-link" data-section="ontology">
                            <i class="fas fa-project-diagram"></i>
                            <span>Ontology Classes</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#graph" class="nav-link" data-section="graph">
                            <i class="fas fa-share-alt"></i>
                            <span>Knowledge Graph</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#documents" class="nav-link" data-section="documents">
                            <i class="fas fa-file-alt"></i>
                            <span>Documents</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#approvals" class="nav-link" data-section="approvals">
                            <i class="fas fa-check-circle"></i>
                            <span>Approvals</span>
                            <span class="approval-count badge" id="approval-count">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#settings" class="nav-link" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Header -->
        <header class="main-header">
            <div class="flex items-center gap-4">
                <h1 id="page-title">Financial Dashboard</h1>
            </div>
            <div class="flex items-center gap-4">
                <button class="btn btn-danger btn-sm" id="wipe-database-btn">
                    <i class="fas fa-trash"></i>
                    Wipe Database
                </button>
                <button class="btn btn-primary btn-sm" id="refresh-data-btn">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <h2>Financial Dashboard</h2>
                    <div class="dashboard-actions">
                        <button class="btn btn-primary" id="add-widget-btn">
                            <i class="fas fa-plus"></i>
                            Add Widget
                        </button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-documents">0</div>
                        <div class="stat-label">Documents</div>
                        <div class="stat-change positive">+0 this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-ontology-classes">0</div>
                        <div class="stat-label">Ontology Classes</div>
                        <div class="stat-change positive">+0 this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-observations">0</div>
                        <div class="stat-label">Financial Observations</div>
                        <div class="stat-change positive">+0 this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-datasets">0</div>
                        <div class="stat-label">Datasets</div>
                        <div class="stat-change positive">+0 this month</div>
                    </div>
                </div>

                <!-- Widget Canvas -->
                <div class="widget-canvas" id="widget-canvas">
                    <!-- Default widgets will be loaded here -->
                    <div class="widget-placeholder" id="widget-placeholder">
                        <div class="placeholder-content">
                            <i class="fas fa-plus-circle"></i>
                            <h3>Add Your First Widget</h3>
                            <p>Click "Add Widget" to create custom visualizations, tables, or analytics based on your data.</p>
                            <button class="btn btn-primary" onclick="document.getElementById('add-widget-btn').click()">
                                <i class="fas fa-plus"></i>
                                Get Started
                            </button>
                        </div>
                    </div>
                </div>


            </section>

            <!-- Chat Section -->
            <section id="chat-section" class="content-section hidden">
                <div class="chat-container">
                    <div class="chat-header">
                        <h3>AI Financial Assistant</h3>
                        <p class="text-secondary">Ask questions about your financial data or upload documents</p>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <div class="message">
                            <div class="message-avatar">AI</div>
                            <div class="message-content">
                                Hello! I'm your AI financial assistant. You can ask me questions about your financial data or upload documents for analysis. How can I help you today?
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <button class="btn btn-secondary file-upload-btn" id="file-upload-btn">
                                <i class="fas fa-paperclip"></i>
                                <input type="file" class="file-upload-input" id="file-upload-input" 
                                       accept=".json,.pdf,.csv,.xlsx,.txt" multiple>
                            </button>
                            <textarea class="chat-input" id="chat-input" 
                                    placeholder="Ask about your financial data or upload documents..."
                                    rows="1"></textarea>
                            <button class="btn btn-primary" id="send-message-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div id="file-preview" class="file-preview hidden"></div>
                    </div>
                </div>
            </section>

            <!-- Ontology Section -->
            <section id="ontology-section" class="content-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Ontology Classes</h3>
                        <button class="btn btn-primary btn-sm" id="refresh-ontology-btn">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Class ID</th>
                                        <th>Label</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ontology-classes">
                                    <tr>
                                        <td colspan="5" class="text-center">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Knowledge Graph Section -->
            <section id="graph-section" class="content-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Knowledge Graph</h3>
                        <div class="flex items-center gap-4">
                            <select id="graph-layout-select" class="form-select">
                                <option value="cose-bilkent">Hierarchical</option>
                                <option value="circle">Circle</option>
                                <option value="grid">Grid</option>
                                <option value="breadthfirst">Tree</option>
                            </select>
                            <button class="btn btn-secondary btn-sm" id="fit-graph-btn">
                                <i class="fas fa-expand-arrows-alt"></i>
                                Fit
                            </button>
                            <button class="btn btn-primary btn-sm" id="refresh-graph-btn">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="graph-container">
                            <div id="knowledge-graph" style="height: 600px; width: 100%; border: 1px solid var(--border); border-radius: var(--radius);"></div>
                        </div>
                        <div class="graph-controls mt-4">
                            <div class="flex items-center gap-4">
                                <div class="graph-legend">
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: #2563eb;"></div>
                                        <span>Ontology Classes</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: #10b981;"></div>
                                        <span>Financial Entities</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: #f59e0b;"></div>
                                        <span>Documents</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: #ef4444;"></div>
                                        <span>Relationships</span>
                                    </div>
                                </div>
                                <div class="graph-stats">
                                    <span id="graph-node-count">0 nodes</span>
                                    <span id="graph-edge-count">0 edges</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Documents Section -->
            <section id="documents-section" class="content-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Documents</h3>
                        <button class="btn btn-primary btn-sm" id="upload-document-btn">
                            <i class="fas fa-upload"></i>
                            Upload Document
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Filename</th>
                                        <th>Type</th>
                                        <th>Size</th>
                                        <th>Status</th>
                                        <th>Uploaded</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="documents-list">
                                    <tr>
                                        <td colspan="6" class="text-center">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Approvals Section -->
            <section id="approvals-section" class="content-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Pending Approvals</h3>
                        <span class="badge" id="pending-count">0 pending</span>
                    </div>
                    <div class="card-content">
                        <div id="approval-items">
                            <p class="text-center text-secondary">No pending approvals</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Node Details Modal -->
            <div id="nodeModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalTitle">Node Details</h3>
                        <span class="modal-close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div id="nodeDetails" class="node-details"></div>

                        <!-- Record-specific chatbot -->
                        <div class="record-chat-section">
                            <h4>Ask about this record</h4>
                            <div id="recordChatMessages" class="record-chat-messages"></div>
                            <div class="record-chat-input">
                                <input type="text" id="recordChatInput" placeholder="Ask a question about this specific record..." />
                                <button id="recordChatSend">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Widget Creation Modal -->
            <div id="widgetModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Create Custom Widget</h3>
                        <span class="modal-close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="widget-creation-form">
                            <h4>What would you like to visualize?</h4>
                            <p class="text-secondary">Describe what you want to see and our AI will create a custom widget for you.</p>

                            <div class="form-group">
                                <label for="widgetPrompt">Widget Description</label>
                                <textarea id="widgetPrompt" placeholder="Examples:
• Show me a table of all revenue streams
• Create a pie chart of expense categories
• Display the top 5 accounts by amount
• Show a timeline of financial observations
• Create a KPI card for total revenue
• Build a real-time expense tracker
• Show me a graph of monthly trends"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="widgetSize">Widget Size</label>
                                <select id="widgetSize">
                                    <option value="quarter">Quarter (1/4 screen)</option>
                                    <option value="half" selected>Half (1/2 screen)</option>
                                    <option value="full">Full (1/1 screen)</option>
                                </select>
                            </div>

                            <div class="widget-examples">
                                <h5>Quick Templates:</h5>
                                <div class="example-buttons">
                                    <button class="btn btn-outline" onclick="setWidgetExample('revenue-chart')">
                                        <i class="fas fa-chart-line"></i> Revenue Chart
                                    </button>
                                    <button class="btn btn-outline" onclick="setWidgetExample('expense-table')">
                                        <i class="fas fa-table"></i> Expense Table
                                    </button>
                                    <button class="btn btn-outline" onclick="setWidgetExample('kpi-cards')">
                                        <i class="fas fa-tachometer-alt"></i> KPI Dashboard
                                    </button>
                                    <button class="btn btn-outline" onclick="setWidgetExample('live-feed')">
                                        <i class="fas fa-stream"></i> Live Data Feed
                                    </button>
                                    <button class="btn btn-outline" onclick="setWidgetExample('ontology-explorer')">
                                        <i class="fas fa-project-diagram"></i> Ontology Explorer
                                    </button>
                                    <button class="btn btn-outline" onclick="setWidgetExample('document-tracker')">
                                        <i class="fas fa-file-alt"></i> Document Tracker
                                    </button>
                                </div>
                            </div>

                            <div class="modal-actions">
                                <button class="btn btn-secondary" onclick="closeWidgetModal()">Cancel</button>
                                <button class="btn btn-primary" id="createWidgetBtn">
                                    <i class="fas fa-magic"></i>
                                    Create Widget
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <section id="settings-section" class="content-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">System Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="settings-grid">
                            <div class="setting-item">
                                <h4>Database Management</h4>
                                <p class="text-secondary">Manage your database and data</p>
                                <div class="mt-4">
                                    <button class="btn btn-danger" id="confirm-wipe-btn">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Wipe All Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="wipe-confirmation-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Confirm Database Wipe</h3>
            <p>This will permanently delete all data including documents, ontology classes, and financial observations. This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-wipe-btn">Cancel</button>
                <button class="btn btn-danger" id="execute-wipe-btn">
                    <i class="fas fa-trash"></i>
                    Wipe Database
                </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', path='/js/modern-dashboard.js') }}"></script>
</body>
</html>
